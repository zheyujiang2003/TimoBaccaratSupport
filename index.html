<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Timo百家輔助</title>
    <style>
        /* 省略樣式定義 */
    </style>
</head>
<body>

<h1>Timo百家輔助</h1>
<div class="subtext">🔥選房選30局內以提高預測準確率🔥</div>

<div class="container">
    <div class="panel">
        <h2>輸入區</h2>
        <div class="input-group">
            <label for="player">閒牌值（依序輸入三張牌點數）：</label>
            <input type="text" id="player" maxlength="3" placeholder="例如：789 或 780">
        </div>
        <div class="input-group">
            <label for="banker">莊牌值（依序輸入三張牌點數）：</label>
            <input type="text" id="banker" maxlength="3" placeholder="例如：345 或 340">
        </div>
        <button class="calculate-btn" onclick="calculateResult()">計算結果</button>
        <button class="clear-btn" onclick="clearAll()">消除全部</button>

        <div class="social-links desktop">
            <!-- 社交連結 -->
        </div>
        <div class="team-info">🪽虎翼團隊-賭狗情侶🪽</div>
    </div>

    <div class="panel">
        <h2>公式選擇</h2>
        <select id="formulaSelect" onchange="checkFormula()">
            <option value="AP">AP 權重模式</option>
            <option value="ThreePoint">三點叉公式</option>
            <option value="Size">大小牌公式</option>
            <option value="Stability">安定值公式</option>
        </select>

        <div class="prediction-result">
            <h2>AI說</h2>
            <div id="predictionResult">等待輸入...</div>
        </div>
        <div class="accuracy" id="accuracyDisplay">
            <div>目前預測準確率：<span id="accuracyRate">100%</span></div>
        </div>

        <div class="grid-container" id="historyDisplay">
            <!-- 6x6 的棋盤格子樣式 -->
            <script>
                for (let i = 0; i < 36; i++) {
                    document.write('<div class="grid-item"></div>');
                }
            </script>
        </div>
    </div>

    <div class="social-links mobile">
        <!-- 手機社交連結 -->
    </div>
</div>

<script>
    let totalPredictions = 0;
    let correctPredictions = 0;
    const history = [];
    let currentFormula = 'AP';
    const stabilityValues = [
        /* 按照圖片中的安定值表填入對應值，例如 [-3, 0, -2, ...] */
        [-3, 3, 3, 4, 5, 5, 5, 7, 10, 10],
        [0, -3, 3, 3, 4, 4, 6, 7, 10, 10],
        [-2, -2, -3, 0, 4, 4, 5, 6, 10, 10],
        [-2, -2, -2, -2, 0, 4, 4, 5, 10, 10],
        [-4, -4, -4, -4, -4, 0, 4, 5, 10, 10],
        [-5, -5, -5, -5, -5, -4, 0, 5, 10, 10],
        [-6, -6, -5, -5, -5, -5, -5, 0, 10, 10],
        [-10, -10, -10, -10, -10, -5, -4, -5, 0, 10],
        [-10, -10, -10, -10, -10, -10, -10, -10, 0, 10],
        [-10, -10, -10, -10, -10, -10, -10, -10, -10, 0]
    ];

    function checkFormula() {
        currentFormula = document.getElementById("formulaSelect").value;
        if (currentFormula === "Size") {
            alert("本模式較不適合新手，將不展示預測準確率");
            document.getElementById("accuracyDisplay").style.display = "none";
        } else if (currentFormula === "Stability") {
            alert("安定值公式：輸入五局後開始預測");
            document.getElementById("accuracyDisplay").style.display = "none";
        } else {
            document.getElementById("accuracyDisplay").style.display = "block";
        }
        updateAccuracy();
        updateHistoryDisplay();
    }

    function calculateResult() {
        const playerInput = document.getElementById('player').value.padEnd(3, '0');
        const bankerInput = document.getElementById('banker').value.padEnd(3, '0');

        if (!/^[0-9]+$/.test(playerInput) || !/^[0-9]+$/.test(bankerInput) || playerInput.length !== 3 || bankerInput.length !== 3) {
            alert("請確保輸入的牌點數為三位數字，無補牌時請輸入0。");
            return;
        }

        const playerPoints = (parseInt(playerInput[0]) + parseInt(playerInput[1]) + parseInt(playerInput[2])) % 10;
        const bankerPoints = (parseInt(bankerInput[0]) + parseInt(bankerInput[1]) + parseInt(bankerInput[2])) % 10;
        let actualOutcome = playerPoints > bankerPoints ? "閒" : bankerPoints > playerPoints ? "莊" : "和";
        let predictedOutcome, recommendation;

        if (currentFormula === "AP") {
            // AP模式計算
        } else if (currentFormula === "ThreePoint") {
            // 三點叉公式計算
        } else if (currentFormula === "Size") {
            // 大小牌公式計算
        } else if (currentFormula === "Stability") {
            // 安定值公式計算
            if (history.length >= 5) {
                const stabilityValue = stabilityValues[playerPoints][bankerPoints];
                if (stabilityValue < 0) {
                    recommendation = "推薦閒";
                } else if (stabilityValue > 0) {
                    recommendation = "推薦莊";
                } else {
                    recommendation = "無建議";
                }
            } else {
                recommendation = "等待足夠局數...";
            }
        }

        document.getElementById("predictionResult").innerText = recommendation;
        history.push({ actual: actualOutcome, predicted: predictedOutcome });
        updateAccuracy();
        updateHistoryDisplay();
        clearInputs();
    }

    function updateAccuracy() {
        const accuracyRate = totalPredictions <= 1 ? 100 : ((correctPredictions / totalPredictions) * 100).toFixed(2);
        document.getElementById("accuracyRate").innerText = `${accuracyRate}%`;
    }

    function updateHistoryDisplay() {
        const historyDisplay = document.getElementById("historyDisplay");
        const items = historyDisplay.querySelectorAll(".grid-item");

        items.forEach(item => {
            item.classList.remove('zhuang', 'xian', 'heju');
            item.innerText = '';
        });

        history.forEach((entry, index) => {
            const row = index % 6;
            const col = Math.floor(index / 6);
            const targetIndex = row * 6 + col;
            const targetItem = items[targetIndex];
            
            if (entry.actual === "莊") {
                targetItem.classList.add("zhuang");
                targetItem.innerText = "莊";
            } else if (entry.actual === "閒") {
                targetItem.classList.add("xian");
                targetItem.innerText = "閒";
            } else {
                targetItem.classList.add("heju");
                targetItem.innerText = "和";
            }
        });
    }

    function clearInputs() {
        document.getElementById("player").value = "";
        document.getElementById("banker").value = "";
    }

    function clearAll() {
        document.getElementById("player").value = "";
        document.getElementById("banker").value = "";
        document.getElementById("predictionResult").innerText = "等待輸入...";
        document.getElementById("accuracyRate").innerText = "100%";

        totalPredictions = 0;
        correctPredictions = 0;
        history.length = 0;

        updateHistoryDisplay();
    }
</script>

</body>
</html>