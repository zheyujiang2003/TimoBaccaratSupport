<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Timo百家輔助</title>
    <style>
        /* 保留您的 CSS3 美化樣式 */
        /* 設定主體字體、背景和按鈕樣式 */
        @font-face {
            font-family: 'CustomFont';
            src: url('https://zheyujiang2003.github.io/Timo/Custom.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-weight: normal; }
        body, button, select {
            font-family: 'CustomFont', serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e0e5ec 100%);
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            text-align: center;
            overflow-x: hidden;
        }
        h1 { 
            font-size: 2.5em; 
            margin-bottom: 5px; 
            color: #333; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .subtext {
            font-size: 0.9em;
            color: #ff6347;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
            max-width: 600px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            padding: 25px;
            overflow: hidden;
            align-items: center;
        }

        /* 其他樣式保留 */
        /* 如橫屏佈局、按鈕樣式、社交媒體連結等 */
        .social-links .youtube { background-image: url('https://upload.wikimedia.org/wikipedia/commons/0/09/YouTube_full-color_icon_%282017%29.svg'); }
        .social-links .instagram { background-image: url('https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png'); }
        .social-links .line { background-image: url('https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg'); }
    </style>
</head>
<body>

<h1>Timo百家輔助</h1>
<div class="subtext">🔥選房選30局內以提高預測準確率🔥</div>

<div class="container">
    <div class="panel">
        <h2>輸入區</h2>
        <div class="input-group">
            <label for="player">閒牌值（依序輸入三張牌點數）：</label>
            <input type="text" id="player" maxlength="3" placeholder="例如：789 或 780">
        </div>
        <div class="input-group">
            <label for="banker">莊牌值（依序輸入三張牌點數）：</label>
            <input type="text" id="banker" maxlength="3" placeholder="例如：345 或 340">
        </div>
        <button class="calculate-btn" onclick="calculateResult()">計算結果</button>
        <button class="clear-btn" onclick="clearAll()">消除全部</button>

        <div class="social-links desktop">
            <a href="https://youtube.com/channel/UCj1P2Tt82JtrbhVXui8DXcg?si=V9NidILTpYH3dTZx" target="_blank" class="youtube"></a>
            <a href="https://www.instagram.com/gamble_couple666/profilecard/?igsh=OGt1ZGJndHNiMTB4" target="_blank" class="instagram"></a>
            <a href="https://lin.ee/ivW2LRm" target="_blank" class="line"></a>
        </div>
        <div class="team-info">🪽虎翼團隊-賭狗情侶🪽</div>
    </div>

    <div class="panel">
        <h2>公式選擇</h2>
        <select id="formulaSelect" onchange="checkFormula()">
            <option value="AP">AP 權重公式</option>
            <option value="ThreePoint">三點叉公式</option>
            <option value="Size">大小牌公式</option>
            <option value="PointDifference">點差公式</option>
            <option value="Exclusive">Timo 獨家公式 (Beta)</option>
        </select>

        <div class="prediction-result">
            <h2>AI說</h2>
            <div id="predictionResult">等待輸入...</div>
        </div>
        <div class="accuracy" id="accuracyDisplay">
            <div>目前預測準確率：<span id="accuracyRate">100%</span></div>
        </div>

        <div class="grid-container" id="historyDisplay">
            <script>
                for (let i = 0; i < 36; i++) {
                    document.write('<div class="grid-item"></div>');
                }
            </script>
        </div>
    </div>

    <div class="social-links mobile">
        <a href="https://youtube.com/channel/UCj1P2Tt82JtrbhVXui8DXcg?si=V9NidILTpYH3dTZx" target="_blank" class="youtube"></a>
        <a href="https://www.instagram.com/gamble_couple666/profilecard/?igsh=OGt1ZGJndHNiMTB4" target="_blank" class="instagram"></a>
        <a href="https://lin.ee/ivW2LRm" target="_blank" class="line"></a>
    </div>
</div>

<script>
    let totalPredictions = 0;
    let correctPredictions = 0;
    const history = [];
    let currentFormula = 'AP';
    let pointDifferenceHistory = [];
    let consecutiveWins = 0;

    function checkFormula() {
        currentFormula = document.getElementById("formulaSelect").value;
        if (currentFormula === "Size" || currentFormula === "PointDifference" || currentFormula === "Exclusive") {
            alert("本模式較不適合新手，將不展示預測準確率");
            document.getElementById("accuracyDisplay").style.display = "none";
        } else {
            document.getElementById("accuracyDisplay").style.display = "block";
        }
        updateAccuracy();
        updateHistoryDisplay();
    }

    function calculateResult() {
        const playerInput = document.getElementById('player').value.padEnd(3, '0');
        const bankerInput = document.getElementById('banker').value.padEnd(3, '0');

        if (!/^[0-9]+$/.test(playerInput) || !/^[0-9]+$/.test(bankerInput) || playerInput.length !== 3 || bankerInput.length !== 3) {
            alert("請確保輸入的牌點數為三位數字，無補牌時請輸入0。");
            return;
        }

        const playerPoints = (parseInt(playerInput[0]) + parseInt(playerInput[1]) + parseInt(playerInput[2])) % 10;
        const bankerPoints = (parseInt(bankerInput[0]) + parseInt(bankerInput[1]) + parseInt(bankerInput[2])) % 10;
        let actualOutcome = playerPoints > bankerPoints ? "閒" : bankerPoints > playerPoints ? "莊" : "和";
        let predictedOutcome, recommendation;

        // Timo 獨家公式邏輯
        if (currentFormula === "Exclusive") {
            // 1. 連勝檢測
            if (history.length > 0 && history[history.length - 1].actual === actualOutcome) {
                consecutiveWins++;
            } else {
                consecutiveWins = 1;
            }
            let reverseBet = consecutiveWins >= 3 ? (actualOutcome === "莊" ? "閒" : "莊") : actualOutcome;

            // 2. 假設隨機森林和貝葉斯邏輯結果（模擬）
            let bayesianBet = Math.random() > 0.5 ? "莊" : "閒"; 
            let randomForestBet = Math.random() > 0.5 ? "莊" : "閒"; 

            // 3. 滾動窗口計算（10局）
            let rollingWindow = history.slice(-10).filter(x => x.actual === "莊").length > 5 ? "莊" : "閒";

            // 4. 綜合決策
            recommendation = (reverseBet === "莊" && bayesianBet === "莊" && rollingWindow === "莊") ? "推薦莊" :
                             (reverseBet === "閒" && bayesianBet === "閒" && rollingWindow === "閒") ? "推薦閒" : "震盪期 看一把或反下";
        } else {
            recommendation = "等待輸入...";
        }

        document.getElementById("predictionResult").innerText = recommendation;
        history.push({ actual: actualOutcome, predicted: predictedOutcome });
        updateAccuracy();
        updateHistoryDisplay();
        clearInputs();
    }

    function updateAccuracy() {
        const accuracyRate = totalPredictions <= 1 ? 100 : ((correctPredictions / totalPredictions) * 100).toFixed(2);
        document.getElementById("accuracyRate").innerText = `${accuracyRate}%`;
    }

    function updateHistoryDisplay() {
        const historyDisplay = document.getElementById("historyDisplay");
        const items = historyDisplay.querySelectorAll(".grid-item");

        items.forEach(item => {
            item.classList.remove('zhuang', 'xian', 'heju');
            item.innerText = '';
        });

        history.forEach((entry, index) => {
            const row = index % 6;
            const col = Math.floor(index / 6);
            const targetIndex = row * 6 + col;
            const targetItem = items[targetIndex];
            
            if (entry.actual === "莊") {
                targetItem.classList.add("zhuang");
                targetItem.innerText = "莊";
            } else if (entry.actual === "閒") {
                targetItem.classList.add("xian");
                targetItem.innerText = "閒";
            } else {
                targetItem.classList.add("heju");
                targetItem.innerText = "和";
            }
        });
    }

    function clearInputs() {
        document.getElementById("player").value = "";
        document.getElementById("banker").value = "";
    }

    function clearAll() {
        document.getElementById("player").value = "";
        document.getElementById("banker").value = "";
        document.getElementById("predictionResult").innerText = "等待輸入...";
        document.getElementById("accuracyRate").innerText = "100%";

        totalPredictions = 0;
        correctPredictions = 0;
        history.length = 0;
        pointDifferenceHistory = [];
        consecutiveWins = 0;

        updateHistoryDisplay();
    }
</script>

</body>
</html>